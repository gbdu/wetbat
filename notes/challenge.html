<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-06-13 Sat 18:39 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Wetbat Project</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="garg" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Wetbat Project</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org793c75b">1. Wetbat Project</a>
<ul>
<li><a href="#orga30d1b7">1.1. Objective</a></li>
<li><a href="#org65c6270">1.2. Implementation choices</a>
<ul>
<li><a href="#orgb80c8a9">1.2.1. Backend: FeathersJS + sequelize ORM + MySQL/MariaDB</a></li>
<li><a href="#org8d2cc73">1.2.2. Frontend: ReactJS + Material Dashboard Pro components</a></li>
</ul>
</li>
<li><a href="#org2989405">1.3. Data achitecture</a></li>
<li><a href="#org35a4d24">1.4. Developer notes</a></li>
<li><a href="#org312f591">1.5. Build notes</a></li>
</ul>
</li>
<li><a href="#orgb0c8dfb">2. Bugs, notes, TODO</a>
<ul>
<li>
<ul>
<li><a href="#org71e39ac">2.0.1. Note</a></li>
<li><a href="#orgf2270e8">2.0.2. <span class="todo TODO">TODO</span> Caching</a></li>
<li><a href="#org870fdbd">2.0.3. <span class="todo TODO">TODO</span> The quotes table doesn't display after deleting a record</a></li>
<li><a href="#org7bb2fe0">2.0.4. <span class="done DONE">DONE</span> Display last 5 quotes in svg map component on dashboard</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org793c75b" class="outline-2">
<h2 id="org793c75b"><span class="section-number-2">1</span> Wetbat Project</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orga30d1b7" class="outline-3">
<h3 id="orga30d1b7"><span class="section-number-3">1.1</span> Objective</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Develop RESTful app to manage airflight quotes
</p>
</div>
</div>
<div id="outline-container-org65c6270" class="outline-3">
<h3 id="org65c6270"><span class="section-number-3">1.2</span> Implementation choices</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-orgb80c8a9" class="outline-4">
<h4 id="orgb80c8a9"><span class="section-number-4">1.2.1</span> Backend: FeathersJS + sequelize ORM + MySQL/MariaDB</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
For the API layer I'm going to use <a href="https://feathersjs.com/">FeathersJS</a> which supports JSON and
realtime communication via Socket.io &#x2013; it also offers a cli which
makes it easy to generate services/endpoints and processing hooks.
</p>

<p>
We have a choice between multiple database adapters, but I decided to go
with <a href="https://sequelize.org/">sequelize</a> which is an ORM that supports Postgres, MySQL, MariaDB,
SQLites and Microsoft SQL. It also provices a cli for managing
migrations, model creation, seeding, etc.
</p>

<p>
I configured it to run with a MariaDB Docker image &#x2013; which keeps a
volume in the db/ directory for data persistance across hosts.
</p>
</div>
</div>

<div id="outline-container-org8d2cc73" class="outline-4">
<h4 id="org8d2cc73"><span class="section-number-4">1.2.2</span> Frontend: ReactJS + Material Dashboard Pro components</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
I decided to use some pre-styled components from <a href="https://www.creative-tim.com/product/material-dashboard-pro-react">Material Dashboard</a> to
save time, as well as other packages like react-datetime for time
selection and sweetalert for alerts and confirmation dialogues. As
well as the autocompelete from @material-ui/lab.
</p>

<p>
I used the new <a href="https://reactjs.org/docs/context.html">Context API</a> instead of Redux for global state
management. 
</p>
</div>
</div>
</div>

<div id="outline-container-org2989405" class="outline-3">
<h3 id="org2989405"><span class="section-number-3">1.3</span> Data achitecture</h3>
<div class="outline-text-3" id="text-1-3">
<p>
The API exposes three endpoints:
</p>

<ul class="org-ul">
<li>/contacts : customer contact info</li>
<li>/quotes : quotes associated with customers</li>
<li>/airports : a list of airports</li>
</ul>

<p>
We know contacts has a one-to-many relationship with quotes (one user
can request multiple quotes), this means the quotes table will have a
"contactId" foreign key column for the associated contact.
</p>

<p>
We define this relationship in sequelize this way:
</p>
<div class="org-src-container">
<pre class="src src-javascript">contacts.hasMany(models.quotes, { foreignKey: { allowNull: <span style="color: #BFEBBF; font-weight: bold;">false</span> }, onDelete: <span style="color: #EE9393;">'CASCADE'</span> });
</pre>
</div>


<p>
When the user requests a quote, we don't just want the user ID
returned, as this means we'd have to make a second request to get the
contact info, so we create a "hook" in Feathers that will populate
the contact field with the complete contact info and pass it with the
request. 
</p>


<div class="figure">
<p><img src="img1.png" alt="img1.png" />
</p>
</div>

<p>
For the /airports endpoint, I found a JSON file which contained a list
of airports and their associated codes, as well as coordinates which
we can use to seed a sequelize model.
</p>

<p>
The first time I attempted to do this I was presented with an error: 
</p>

<div class="org-src-container">
<pre class="src src-bash">[~/wetbat/api]$ sequelize-cli db:seed:all                                                                                          *[master] 

Sequelize CLI [Node: 14.4.0, CLI: 5.5.1, ORM: 5.21.12]

Loaded configuration file <span style="color: #EE9393;">"config/config.json"</span>.
Using environment <span style="color: #EE9393;">"development"</span>.

== 20200610011347-airports-from-json: <span style="color: #DFAF8F;">migrating</span> =======

ERROR: Incorrect string value: <span style="color: #EE9393;">'\xC4\xB1'</span> for column <span style="color: #CC9393;">`basicdb`</span>.<span style="color: #CC9393;">`airports`</span>.<span style="color: #CC9393;">`city`</span> at row 88
</pre>
</div>

<p>
Apparently, Maria/MySQL only supports 3 byte utf8 characters by
default for string fields, so I had to manually set the collate to
`utf8_bin` for this particular model, although this should probably be
set for all other models as well:
</p>

<div class="org-src-container">
<pre class="src src-javascript">charset: <span style="color: #EE9393;">'utf8'</span>,
collate: <span style="color: #EE9393;">'utf8_bin'</span>, <span style="color: #753435;">// </span><span style="color: #696969; font-style: italic;">this is to allow for 4-byte utf-8 chars</span>
</pre>
</div>

<p>
The actual airport column on the quotes table contains only the
airport code, however we can use another hook to return the associated
info from the airports table in /quotes as well, so the frontend can
display the coordinates in <a href="https://jvectormap.com/">jVectorMap</a> 
</p>


<div class="figure">
<p><img src="img2.png" alt="img2.png" />
</p>
</div>
</div>
</div>


<div id="outline-container-org35a4d24" class="outline-3">
<h3 id="org35a4d24"><span class="section-number-3">1.4</span> Developer notes</h3>
<div class="outline-text-3" id="text-1-4">
<p>
This is the first time I've used third-party components in
React. Although I have my own component library for VueJS built from
scratch with Bootstrap5 styling, I didn't have such code on hand for
React, so I had to rely on Material Dashboard to save time.
</p>

<p>
This lead me to learning about form validation in React; instead of
doing validation by hand like I first did in CreateOrEditQuote.js, I
used React Form Hooks for the contact form creation.  Learning a bit
more about <a href="https://reactjs.org/docs/refs-and-the-dom.html">React refs and the DOM</a> in order to pass the refs to the
inner components of Material Dashboard Pro components &#x2026;
</p>

<p>
For the API, it was also my first time working with FeathersJS and
sequelizer, although the same ORM concepts applies with my previous
experience with django-rest-framework, I actually found the sequelizer
cli and Feathers cli pretty fun to work with, and finally, you get the
added benefit of working with ES6/NodeJS on both your frontend and
backend &#x2013; not to mention the potential of easily using Socket-io for
realtime communication between clients, say for something like a chat
client.
</p>
</div>
</div>


<div id="outline-container-org312f591" class="outline-3">
<h3 id="org312f591"><span class="section-number-3">1.5</span> Build notes</h3>
<div class="outline-text-3" id="text-1-5">
<p>
The frontend and backend can be built simply by cding into their
respective directories and either installing the npm packages locally
and running npm start, or by deploying the dockerfiles provided into
seperate containers:
</p>


<div class="org-src-container">
<pre class="src src-bash"><span style="color: #bfbfcf; font-weight: bold;">cd</span> frontend
docker build -t myfrontend . 
<span style="color: #753435;"># </span><span style="color: #696969; font-style: italic;">deploy the image to any port you want</span>
docker run -d -p 5000:5000 --name myfrontendcontainer myfrontend
</pre>
</div>


<p>
The dockerfile for the backend also takes care of running the
migrations and seeding the airports table. I've also created a seeder
that uses <a href="https://github.com/marak/Faker.js/">faker</a> to populate the db with some fake records.
</p>
</div>
</div>
</div>


<div id="outline-container-orgb0c8dfb" class="outline-2">
<h2 id="orgb0c8dfb"><span class="section-number-2">2</span> Bugs, notes, TODO</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org71e39ac" class="outline-4">
<h4 id="org71e39ac"><span class="section-number-4">2.0.1</span> Note</h4>
<div class="outline-text-4" id="text-2-0-1">
<p>
I spent most of the time on this project learning about the backend,
react hooks, passing data between components, and conditional
rendering. I was testing mostly against a MariaDB docker
instance. Usually I use docker-compose on my vps which is a somewhat
primitive method of orchestration, my understanding is that  it can be
converted to a kubernetes cluster with the "kompose" command, but I
couldn't figure out how to do it &#x2013; I ended up spending more time
reading about Minikube than working on the final product!
</p>

<p>
Eventually I decided to swap out the MariaDB driver for sqlite in
sequelizer (which only took one line) and then deploying the frontend
an backend seperately to heroku.
</p>
</div>
</div>

<div id="outline-container-orgf2270e8" class="outline-4">
<h4 id="orgf2270e8"><span class="section-number-4">2.0.2</span> <span class="todo TODO">TODO</span> Caching</h4>
<div class="outline-text-4" id="text-2-0-2">
<p>
Some components use caching by storing into context, mainly the quotes
and contacts tables. Other components like the autocomplete input for
the airport name is fetched asynchronously when the user needs it.
</p>

<p>
Pagination is enabled by default on FeathersJS, and we also have a
react table with pagination, we could use this to fetch a few pages of
rows, and then fetch more as the user clicks next.
</p>
</div>
</div>

<div id="outline-container-org870fdbd" class="outline-4">
<h4 id="org870fdbd"><span class="section-number-4">2.0.3</span> <span class="todo TODO">TODO</span> The quotes table doesn't display after deleting a record</h4>
<div class="outline-text-4" id="text-2-0-3">
<p>
have to renavigate to quotes to redisplay again. This should probably
be fixed by using history.push('/') 
</p>
</div>
</div>

<div id="outline-container-org7bb2fe0" class="outline-4">
<h4 id="org7bb2fe0"><span class="section-number-4">2.0.4</span> <span class="done DONE">DONE</span> Display last 5 quotes in svg map component on dashboard</h4>
<div class="outline-text-4" id="text-2-0-4">
<p>
The table above it is meaningless, but the markers on the map correspond
to the destination airport's coordinates from the last 5 quotes.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: garg</p>
<p class="date">Created: 2020-06-13 Sat 18:39</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
